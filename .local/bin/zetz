#!/usr/bin/env bash
set -e

main() {
  file_to_edit=`select_file`

  if [ "$file_to_edit" = "-- NEW --" ]; then
    nvim +NewZettel
    main
  fi

  if [ -n "$file_to_edit" ] ; then
    nvim "$file_to_edit"
    main "$file_to_edit"
  fi
  cd -
}

select_file() {
  { echo "-- NEW --"; find *.md -path assets -prune -o -print -type f; } \
    | tr - - \
    | fzf --preview="[[ {} == '-- NEW --' ]] && echo '' || cat {}" --height=100% --preview-window=right:60%:wrap
}

main ""
